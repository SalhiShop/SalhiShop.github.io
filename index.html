<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Salhi Shop</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #e0f7fa;
    color: #004d40;
  }
  header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #00bcd4;
    color: white;
    padding: 10px 20px;
  }
  header h1 {
    margin: 0;
    font-size: 1.5em;
  }
  header .user-info {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  header .user-info button {
    padding: 5px 10px;
    border: none;
    background: white;
    color: #00bcd4;
    border-radius: 4px;
    cursor: pointer;
  }
  header .user-info span {
    font-weight: bold;
  }
  main {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 70vh;
    text-align: center;
    flex-direction: column;
    gap: 20px;
  }
  button.action-btn {
    background: #00bcd4;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 1em;
  }
  button.action-btn:hover {
    background: #0097a7;
  }
  #retourBtn {
    position: absolute;
    top: 10px;
    right: 20px;
    background: #004d40;
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
  }
</style>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyByfz30HgKDfynhOXb24hSOReTJOfk77mI",
  authDomain: "salhishop-1.firebaseapp.com",
  projectId: "salhishop-1",
  storageBucket: "salhishop-1.firebasestorage.app",
  messagingSenderId: "784629559774",
  appId: "1:784629559774:web:388f9ca4c33e90d6fcad4f",
  measurementId: "G-34G9453E7H"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");
const displayName = document.getElementById("displayName");
const mainContent = document.getElementById("mainContent");

onAuthStateChanged(auth, async (user) => {
  if (user && user.emailVerified) {
    const docRef = doc(db, "users", user.uid);
    const docSnap = await getDoc(docRef);
    const pseudo = docSnap.exists() ? docSnap.data().pseudo : user.email;

    displayName.innerText = pseudo;
    loginBtn.style.display = "none";
    logoutBtn.style.display = "inline-block";
    mainContent.style.justifyContent = "flex-start";
    mainContent.style.alignItems = "flex-start";
  } else {
    displayName.innerText = "";
    loginBtn.style.display = "inline-block";
    logoutBtn.style.display = "none";
    mainContent.style.display = "flex";
    mainContent.style.justifyContent = "center";
    mainContent.style.alignItems = "center";
    mainContent.style.height = "70vh";
  }
});

function logout() {
  signOut(auth).then(() => alert("Déconnecté avec succès !"));
}

function passerCommande() {
  const user = auth.currentUser;
  if (!user || !user.emailVerified) {
    alert("Vous devez être connecté et avoir vérifié votre email pour passer une commande.");
    return;
  }
  alert("Commande en cours !");
}
</script>
</head>
<body>
<header>
  <h1>Salhi Shop</h1>
  <div class="user-info">
    <span id="displayName"></span>
    <button id="loginBtn" onclick="window.location.href='login.html'">Se connecter</button>
    <button id="logoutBtn" onclick="logout()" style="display:none;">Se déconnecter</button>
  </div>
</header>

<button id="retourBtn" onclick="window.location.href='index.html'">Retour</button>

<main id="mainContent">
  <div>
    <h2>Bienvenue sur Salhi Shop !</h2>
    <p>Découvrez nos produits et promotions.</p>
    <section id="commandes">
      <h3>Passer une commande</h3>
      <button class="action-btn" onclick="passerCommande()">Commander</button>
    </section>
  </div>
</main>
</body>
</html>
