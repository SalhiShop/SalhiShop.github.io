<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Salhi Shop</title>

  <!-- Styles intégrés (cyan / moderne) -->
  <style>
    body {
      margin: 0;
      font-family: Arial, Helvetica, sans-serif;
      background-color: #f0f7fa;
      color: #03363a;
    }

    /* Header principal */
    .header {
      background-color: #00bcd4;
      color: white;
      padding: 14px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.12);
    }
    .header h1 { margin: 0; font-size: 1.4rem; }

    .user-block {
      display: flex;
      align-items: center;
      gap: 12px;
      color: white;
    }

    .pseudo {
      font-weight: 700;
      background: rgba(255,255,255,0.08);
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 0.95rem;
    }

    .email-small {
      display: block;
      font-size: 0.80rem;
      color: rgba(255,255,255,0.9);
      margin-top: -6px;
    }

    .btn-plain {
      background: white;
      color: #00bcd4;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 700;
      box-shadow: 0 2px 6px rgba(0,0,0,0.12);
    }
    .btn-plain:hover { transform: translateY(-1px); }

    .btn-logout {
      background: #f44336;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 700;
      box-shadow: 0 2px 6px rgba(0,0,0,0.12);
    }
    .btn-logout:hover { transform: translateY(-1px); }

    /* Barre secondaire */
    .secondary-nav {
      background: #00acc1;
      display: flex;
      justify-content: center;
      gap: 28px;
      padding: 10px 0;
      color: white;
      font-weight: 700;
    }
    .secondary-nav a {
      color: white;
      text-decoration: none;
      padding: 6px 12px;
      border-radius: 8px;
    }
    .secondary-nav a:hover { background: rgba(255,255,255,0.08); }

    /* Contenu principal centré */
    main {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: calc(100vh - 140px);
      text-align: center;
      padding: 20px;
    }

    .card {
      background: white;
      padding: 28px;
      border-radius: 12px;
      box-shadow: 0 12px 30px rgba(2, 50, 50, 0.06);
      max-width: 780px;
      width: 100%;
    }

    .card h2 {
      color: #00bcd4;
      margin: 0 0 8px 0;
      font-size: 1.8rem;
    }
    .card p { margin: 0 0 16px 0; color: #275a5b; }

    .action-btn {
      background: #00bcd4;
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
    }
    .action-btn:hover { background: #0097a7; transform: translateY(-2px); }

    @media (max-width: 640px) {
      .header h1 { font-size: 1.1rem; }
      .card { padding: 20px; }
      .card h2 { font-size: 1.4rem; }
      .secondary-nav { gap: 14px; font-size: 0.95rem; }
    }
  </style>

  <!-- Firebase compat CDN (pas d'import ES modules) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

</head>
<body>

  <!-- Header -->
  <header class="header">
    <h1>Salhi Shop</h1>

    <div class="user-block">
      <div id="pseudoWrap" class="pseudo" style="display:none;"></div>
      <div id="emailWrap" class="email-small" style="display:none;"></div>

      <button id="loginBtn" class="btn-plain" onclick="window.location.href='login.html'">Se connecter</button>
      <button id="logoutBtn" class="btn-logout" style="display:none;">Se déconnecter</button>
    </div>
  </header>

  <!-- Barre secondaire -->
  <nav class="secondary-nav">
    <a href="index.html">Accueil</a>
    <a href="#commandes">Commande</a>
    <a href="#info">Info</a>
  </nav>

  <!-- Contenu -->
  <main>
    <div class="card">
      <h2>Bienvenue sur Salhi Shop !</h2>
      <p>Découvrez nos produits et promotions.</p>

      <section id="commandes">
        <h3>Passer une commande</h3>
        <button class="action-btn" id="orderBtn">Commander</button>
      </section>

      <section id="info" style="margin-top:18px;color:#567;font-size:0.95rem;">
        <p>Infos : adresse du magasin, horaires, contact…</p>
      </section>
    </div>
  </main>

  <!-- Logique Firebase (compat) -->
  <script>
    // Initialise Firebase (compat)
    const firebaseConfig = {
      apiKey: "AIzaSyByfz30HgKDfynhOXb24hSOReTJOfk77mI",
      authDomain: "salhishop-1.firebaseapp.com",
      projectId: "salhishop-1",
      storageBucket: "salhishop-1.firebasestorage.app",
      messagingSenderId: "784629559774",
      appId: "1:784629559774:web:388f9ca4c33e90d6fcad4f",
      measurementId: "G-34G9453E7H"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // DOM éléments
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const pseudoWrap = document.getElementById('pseudoWrap');
    const emailWrap = document.getElementById('emailWrap');
    const orderBtn = document.getElementById('orderBtn');

    // Fonction déconnexion exposée globalement
    window.logout = async function() {
      try {
        await auth.signOut();
        alert('Déconnecté avec succès !');
      } catch (err) {
        alert('Erreur lors de la déconnexion : ' + err.message);
      }
    };

    // Fonction de commande (vérifie emailVerified)
    window.passerCommande = function() {
      const user = auth.currentUser;
      if (!user || !user.emailVerified) {
        alert('Vous devez être connecté et avoir vérifié votre email pour passer une commande.');
        return;
      }
      alert('Commande en cours (implémenter sauvegarde si besoin).');
    };

    orderBtn.addEventListener('click', () => window.passerCommande());

    // Surveille l'état de connexion
    auth.onAuthStateChanged(async (user) => {
      if (user) {
        // récupère pseudo depuis Firestore si présent
        let pseudo = null;
        try {
          const docRef = db.collection('users').doc(user.uid);
          const docSnap = await docRef.get();
          if (docSnap.exists) {
            const data = docSnap.data();
            if (data && data.pseudo) pseudo = data.pseudo;
          }
        } catch (err) {
          console.warn('Erreur récupération Firestore pseudo :', err);
        }

        const shownName = pseudo || user.displayName || (user.email ? user.email.split('@')[0] : 'Utilisateur');
        pseudoWrap.textContent = shownName;
        pseudoWrap.style.display = 'inline-block';

        emailWrap.textContent = user.email || '';
        emailWrap.style.display = user.email ? 'inline-block' : 'none';

        loginBtn.style.display = 'none';
        logoutBtn.style.display = 'inline-block';
      } else {
        // pas connecté
        pseudoWrap.style.display = 'none';
        emailWrap.style.display = 'none';
        loginBtn.style.display = 'inline-block';
        logoutBtn.style.display = 'none';
      }
    });

    // Assure que logout appelle la fonction globale (si bouton inline utilisé)
    logoutBtn.addEventListener('click', window.logout);
  </script>
</body>
</html>
