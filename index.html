<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Salhi Shop</title>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyByfz30HgKDfynhOXb24hSOReTJOfk77mI",
  authDomain: "salhishop-1.firebaseapp.com",
  projectId: "salhishop-1",
  storageBucket: "salhishop-1.appspot.com",
  messagingSenderId: "784629559774",
  appId: "1:784629559774:web:388f9ca4c33e90d6fcad4f",
  measurementId: "G-34G9453E7H"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");
const userInfo = document.getElementById("userInfo");
const adminBtn = document.getElementById("adminBtn");

onAuthStateChanged(auth, async (user) => {
  if (user) {
    const userDoc = await getDoc(doc(db, "users", user.uid));
    const pseudo = userDoc.exists() && userDoc.data().pseudo ? userDoc.data().pseudo : "Utilisateur";
    userInfo.innerHTML = `${pseudo}<br><small>${user.email}</small>`;
    loginBtn.style.display = "none";
    logoutBtn.style.display = "inline-block";

    // Vérifier si c'est admin
    const adminDoc = await getDoc(doc(db, "meta", "admins"));
    if (adminDoc.exists() && adminDoc.data().emails.includes(user.email)) {
      adminBtn.style.display = "inline-block";
    } else {
      adminBtn.style.display = "none";
    }
  } else {
    userInfo.innerHTML = "";
    loginBtn.style.display = "inline-block";
    logoutBtn.style.display = "none";
    adminBtn.style.display = "none";
  }
});

logoutBtn.addEventListener("click", () => {
  signOut(auth);
});
</script>
</head>
<body style="margin:0;font-family:Arial,sans-serif;background:#e0f7fa;">

<!-- Barre principale -->
<header style="background:#00bcd4;color:white;padding:10px 20px;display:flex;justify-content:space-between;align-items:center;">
  <h1 style="margin:0;">Salhi Shop</h1>
  <div>
    <span id="userInfo"></span>
    <button id="loginBtn" onclick="window.location.href='login.html'" style="margin-left:10px;">Se connecter</button>
    <button id="logoutBtn" style="margin-left:10px;display:none;">Se déconnecter</button>
  </div>
</header>

<!-- Barre secondaire -->
<nav style="background:#b2ebf2;text-align:center;padding:10px;">
  <button onclick="window.location.href='index.html'">Accueil</button>
  <button onclick="window.location.href='commande.html'">Commande</button>
  <button onclick="window.location.href='info.html'">Info</button>
  <button id="adminBtn" onclick="window.location.href='admin.html'" style="display:none;">Admin</button>
</nav>

<main style="text-align:center;margin-top:50px;">
  <h2>Bienvenue sur Salhi Shop</h2>
</main>

</body>
</html>
